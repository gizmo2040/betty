<html>
	<head>
		<style>
			 .background{
		    	position: absolute;
		    	background:url('imgs/fondo.jpg');
				width:960px;
			    height:599px;
		    	
		    }
			.frase {
				display: inline-block;
				position: absolute;
				width:600px;
			    height:100px;
				left:180;
				top: 150;
			}
			.wordDiv {
				display: inline-block;
				position: absolute;
				width: 600px;
				height: 100px;
				left:180;
				top: 250;
				
			}
			.lines {
				display: inline-block;
				border: 1px solid black;
				padding: 0px 10px 0px 10px;
			}
			.dragWordClass {
				display: inline-block;
				border: 1px solid black;
				margin: 5px 5px; 
				
			}
			.selectClick {
				display: inline-block;
				border: 3px solid red;
			}
			.select {
				display: inline-block;
				border: 1px solid blue;
			}
			.linesDrop {
				display: inline-block;
				border: 3px solid green;
			}
			#error {
				font-size: 200%;
				color: red;
				position: absolute;
				top: 300;
				left:400;
			}
			#right{
				font-size: 200%;
				color: green;
				position: absolute;
				top: 300;
				left:400;
			}
			#ganoP{
				font-size: 200%;
				color: purple;
				position: absolute;
				top: 300;
				left:400;
			}

		</style>
		<script src="js/jquery-1.7.2.min.js"> </script>
		<script src="js/jquery-ui-1.8.21.custom.min.js"> </script>
	</head>
	<body>

		<script>
			var input_str = "The [click] event is sent to [an] element when the mouse pointer is over the element, and the [mouse] button is pressed and released. Any HTML element can receive this event."
			var contWord = 0;
			var contLines = 0;
			var dragWords = new RegExp(/\[([\w\s]+)\]/g);
			var res = "";
			var prevClicked = null;
			var prevClickedDrag = 0;
	
			
			$(document).ready(init);

			function init() {
				var arrWords = [];
				
				res = input_str.replace(dragWords, function(match, word, position) {
					var returnVar = "<div id='drop-" + position + "' class='lines'>";
					for (var i = 0, max = word.length; i < max; i++) {
						returnVar += "_";
					}

					arrWords.push({"word":word,"position":position});
					contWord += 1;
					return returnVar + "</div>";

				});
				
				
				for (var i = 0, i=0; i < contWord; i++) {
					var wordObj = arrWords.splice(Math.floor(Math.random() * arrWords.length),1)[0];
						$('<div/>', {
						id : "drag-" + wordObj.position,
						class : "dragWordClass"
					}).html(wordObj.word).appendTo('.wordDiv');
				}
					 
				
				$(".frase").html(res);

				$(".dragWordClass").click(wordClick);
				$(".lines").click(wordClick);

			}

			function wordClick(e) {

				var isDrag = ($( e.currentTarget ).attr("id").split("-")[0] == 'drag');

				if (prevClicked) {
					if ((prevClickedDrag && !isDrag) || (!prevClickedDrag && isDrag)) {

						var idPrev = prevClicked.attr("id");
						var dragI = idPrev.split("-");
						var dropId = $(this).attr("id");
						var dropI = dropId.split("-");

						if (dropI[1] == dragI[1]) {
							$("#right").show("slow").delay(300).hide("slow");
							contLines += 1;

							if (prevClickedDrag) {
								var word = $("#" + prevClicked.attr("id")).html();
								$("#" + dropId).html(word);
								$('div').remove("#" + prevClicked.attr("id"));
								$(this).unbind('click');
								$(this).addClass("linesDrop");
							} else {
								var word = $("#" + $(this).attr("id")).html();
								$("#" + prevClicked.attr("id")).html(word);
								$('div').remove("#" + $(this).attr("id"));
								$("#" + prevClicked.attr("id")).unbind('click');
								$("#" + prevClicked.attr("id")).addClass("linesDrop");
							}

							if (contLines == contWord) {
								gano();
							}
							prevClicked = null;
							$(".lines").removeClass("select");
							$(".dragWordClass").removeClass("select");
						}else{
							$("#error").show("slow").delay(300).hide("slow");
						} 
					} else {
						
						$("#" + prevClicked.attr("id")).removeClass("selectClick");
						$("#" + $(this).attr("id")).addClass("selectClick");
						prevClicked = $(e.currentTarget);
					}
				} else {
					if (isDrag) {
						$(".lines").addClass("select");
						$(".dragWordClass").removeClass("select");
					} else {
						$(".dragWordClass").addClass("select");
						$(".lines").removeClass("select");
					}
					prevClicked = $(e.currentTarget);
					$("#" + $(this).attr("id")).addClass("selectClick");
					prevClickedDrag = isDrag;
				}

			}

			function gano() {
				//alert("GANO!!");
				$("#ganoP").delay(1000).show("slow");
				
			}

		</script>
		<div class="background">
		<div class="frase"> </div>
		<br>
		<br>
		<div class="wordDiv"> </div>
		<p style="display: none" id="error"> Error</p> 
		<p style="display: none" id="right"> Right</p> 
		<p style="display: none" id="ganoP"> GANO!!</p> 
        </div>
	</body>
</html>
